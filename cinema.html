<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lista de Canales TV</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.2/dist/plyr.css"/>

  <style>
    body {
      background-color: #141414;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-evenly;
      gap: 10px;
      padding: 20px;
    }

    .channel {
      width: 22%;
      background: linear-gradient(to bottom, #A8A8A8, #ffffff); /* Degradado de plomo a blanco */
      color: #000000;  /* Letras negras por defecto */
      border: 2px solid #A8A8A8;  /* Borde plomo más claro por defecto */
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: background 0.3s ease, border 0.3s ease, color 0.3s ease;  /* Transición suave */
    }

    .channel:hover {
      background: linear-gradient(to bottom, #ffffff, #000000);  /* Degradado de blanco a negro al pasar el ratón */
      border: 2px solid #E3B443;  /* Borde dorado al pasar el ratón */
      color: #ffffff;  /* Letras blancas al pasar el ratón */
    }

    .channel h3 {
      margin-top: 10px;
      font-size: 16px;
    }

    .channel img {
      width: 100%;
      border-radius: 8px;
    }

    #fullscreen-video {
      display: none;
      position: fixed;
      inset: 0;
      background-color: black;
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    .search-container {
      display: flex;
      justify-content: center;
      margin: 20px;
    }

    .search-bar {
      width: 70%;
      padding: 10px;
      font-size: 16px;
      background: #333;
      color: white;
      border: 2px solid #E3B443;
      border-radius: 8px;
    }

    video {
      width: 100%;
      height: 100%;
    }

    /* Media Query para pantallas pequeñas (móviles en vertical) */
    @media (max-width: 480px) {
      .channel {
        width: 48%;  /* Acomoda los recuadros en 2 columnas en pantallas pequeñas */
      }
    }

  </style>
</head>
<body>

  <div id="fullscreen-video">
    <video id="video-player" class="plyr" controls></video>
  </div>

  <div class="search-container">
    <input type="text" id="search-input" class="search-bar" placeholder="Buscar canal..." oninput="filterChannels()" />
  </div>

  <div class="container" id="channels-container"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.2/dist/plyr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/rojasrony12/server/refs/heads/main/c!n3m4.m3u";
    const channelsContainer = document.getElementById("channels-container");
    const fullscreenVideo = document.getElementById("fullscreen-video");
    const videoPlayer = document.getElementById("video-player");
    const searchInput = document.getElementById("search-input");
    let allChannels = [];
    let player = new Plyr(videoPlayer);

    // Cargar y parsear M3U
    fetch(m3uUrl)
      .then(response => response.text())
      .then(data => {
        allChannels = parseM3U(data);
        displayChannels(allChannels);
      })
      .catch(error => console.error("Error al cargar M3U:", error));

    function parseM3U(data) {
      const lines = data.split("\n");
      const channels = [];
      let current = {};

      lines.forEach(line => {
        if (line.startsWith("#EXTINF:")) {
          const nameMatch = line.match(/,(.*)$/);
          const logoMatch = line.match(/tvg-logo="([^"]+)"/);
          current = {
            name: nameMatch ? nameMatch[1].trim() : "Canal sin nombre",
            logo: logoMatch ? logoMatch[1] : "",
          };
        } else if (line.startsWith("http")) {
          current.url = line.trim();
          channels.push(current);
        }
      });

      return channels;
    }

    function displayChannels(channels) {
      channelsContainer.innerHTML = "";
      channels.forEach(channel => {
        const div = document.createElement("div");
        div.className = "channel";
        div.innerHTML = `  
          <img src="${channel.logo || 'https://via.placeholder.com/150?text=Sin+Logo'}" alt="${channel.name}" />
          <h3>${channel.name}</h3>
        `;
        div.onclick = () => playChannel(channel.url);
        channelsContainer.appendChild(div);
      });
    }

    function playChannel(url) {
      const decodedUrl = decodeURIComponent(url);

      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(decodedUrl);
        hls.attachMedia(videoPlayer);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          fullscreenVideo.style.display = "flex";
          player.play();
        });
      } else if (videoPlayer.canPlayType("application/vnd.apple.mpegurl")) {
        videoPlayer.src = decodedUrl;
        fullscreenVideo.style.display = "flex";
        player.play();
      } else {
        alert("Este navegador no puede reproducir este tipo de archivo.");
      }

      // Pantalla completa
      if (fullscreenVideo.requestFullscreen) {
        fullscreenVideo.requestFullscreen();
      }
    }

    function filterChannels() {
      const text = searchInput.value.toLowerCase();
      const filtered = allChannels.filter(c => c.name.toLowerCase().includes(text));
      displayChannels(filtered);
    }

    document.addEventListener("fullscreenchange", () => {
      if (!document.fullscreenElement) {
        fullscreenVideo.style.display = "none";
        player.pause();
      }
    });
  </script>
</body>
</html>
